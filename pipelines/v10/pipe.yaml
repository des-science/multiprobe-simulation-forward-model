# this is meant for Perlmutter, not Euler

# postprocessing
- name: fiducial_tfrecords
  cmd: esub ../msfm/apps/run_fiducial_postprocessing.py \
    --n_files=1000 \
    --config=../configs/v10/linear_bias.yaml \
    --dir_in=/global/cfs/cdirs/des/cosmogrid/v11desy3/CosmoGrid/v11desy3 \
    --dir_out=/pscratch/sd/a/athomsen/v11desy3/v10/linear_bias/tfrecords/fiducial \
    --cosmogrid_version="1.1" \
    --mode=jobarray --function=all --n_jobs=1000 --max_njobs=1000 --tasks="0>1000" --keep_submit_files \
    --job_name=tfr_fidu_v10 --log_dir=/pscratch/sd/a/athomsen/run_files/v10/esub_logs \
    --system=slurm --source_file=../pipelines/v10/perlmutter_setup.sh \
    --additional_slurm_args="--account=des,--constraint=cpu,--qos=shared,--licenses=cfs,--licenses=scratch"

- name: grid_tfrecords
  cmd: esub ../msfm/apps/run_grid_postprocessing.py \
    --n_files=2500 \
    --config=../configs/v10/linear_bias.yaml \
    --dir_in=/global/cfs/cdirs/des/cosmogrid/v11desy3/CosmoGrid/v11desy3 \
    --dir_out=/pscratch/sd/a/athomsen/v11desy3/v10/linear_bias/tfrecords/grid \
    --cosmogrid_version="1.1" \
    --mode=jobarray --function=all --n_jobs=2500 --max_njobs=1000 --tasks="0>2500" --keep_submit_files \
    --job_name=tfr_grid_v10 --log_dir=/pscratch/sd/a/athomsen/run_files/v10/esub_logs \
    --system=slurm --source_file=../pipelines/v10/perlmutter_setup.sh \
    --additional_slurm_args="--account=des,--constraint=cpu,--qos=shared,--licenses=cfs,--licenses=scratch"

# noise generation for the Cls
- name: cl_white_noise
  cmd: esub ../msfm/apps/run_power_spectra_noise.py \
    --n_noise=100000 \
    --n_noise_per_index=1000 \
    --config=../configs/v10/linear_bias.yaml \
    --dir_out=/pscratch/sd/a/athomsen/v11desy3/v10/linear_bias/cls \
    --mode=jobarray --function=all --n_jobs=2500 --system-slurm \
    --job_name=white_noise --log_dir=/pscratch/sd/a/athomsen/run_files/v10/esub_logs \
    --additional_slurm_args="--account=des,--constraint=cpu,--qos=shared,--licenses=cfs,--licenses=scratch"

# UNFAVORED postprocessing, --qos=regular
- name: fiducial_tfrecords
  cmd: esub ../msfm/apps/run_fiducial_postprocessing.py \
    --n_files=1000 \
    --config=../configs/v10/linear_bias.yaml \
    --dir_in=/global/cfs/cdirs/des/cosmogrid/v11desy3 \
    --dir_out=/pscratch/sd/a/athomsen/v11desy3/v10/linear_bias/tfrecords/fiducial \
    --cosmogrid_version="1.1" \
    --mode=jobarray --function=all --n_jobs=1000 --max_nnodes=100 --tasks="0>1000" --per_node_accounting \
    --job_name=tfr_fidu_v10_node --system=slurm --source_file=../pipelines/v10/perlmutter_setup.sh \
    --additional_slurm_args="--account=des,--constraint=cpu,--qos=regular" --keep_submit_files

- name: grid_tfrecords
  cmd: esub ../msfm/apps/run_grid_postprocessing.py \
    --n_files=2500 \
    --config=../configs/v10/linear_bias.yaml \
    --dir_in=/global/cfs/cdirs/des/cosmogrid/v11desy3 \
    --dir_out=/pscratch/sd/a/athomsen/v11desy3/v10/linear_bias/tfrecords/grid \
    --cosmogrid_version="1.1" \
    --mode=jobarray --function=all --n_jobs=2500 --max_nnodes=100 --tasks="0>2500" --per_node_accounting \
    --job_name=tfr_grid_v10_node --system=slurm --source_file=../pipelines/v10/perlmutter_setup.sh \
    --additional_slurm_args="--account=des,--constraint=cpu,--qos=regular" --keep_submit_files
